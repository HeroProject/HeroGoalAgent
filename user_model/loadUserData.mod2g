use '../util/*.pl' as knowledge.
use '../topics/*.pl' as knowledge.
use '../topics/co_creation/*.pl' as knowledge.
use '../sessions' as knowledge.
use '../hero_actions' as actionspec.
use loadUserDataHelper as module.

order=linearall.

module loadUserData(Topics) {
		if bel(nth0(0, Topics, Topic, RestOfTopics), userId(UserId))
			then {
				% Load text variables
				forall bel(text(Topic, _, Text), split_string(Text, '%', "", TextParts), odd_elements(TextParts, Keys))
					do loadUserDataHelper(Keys).
				
				% Load motions
				forall bel(play_motion(Topic, _, Key)) do getUserData(UserId, Key).
				
				% Load audio
				forall bel(audio(Topic, _, recorded, Key), not(waitingForMemoryAudio(Key))) do getUserData(UserId, Key) + insert(waitingForMemoryAudio(Key)).
				
				% Load led animations
				forall bel(play_led_anim(Topic, _, Key)) do getUserData(UserId, Key) + insert(waitingForMemoryLed(Key)).
				
				% Recursive continue with the next topic.
				if not(bel(length(RestOfTopics,0))) then loadUserData(RestOfTopics).
		}
}